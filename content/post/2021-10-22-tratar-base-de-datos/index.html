---
title: Tratar base de datos (sin terminar)
author: Joaquín Alcañiz Colomer
date: '2021-10-22'
slug: tratar-base-de-datos
categories:
  - Estadística
tags: []
output:
  blogdown::html_page:
    toc: true
    css: "/css/my-style.css"
leng: es-ES 
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
  <link rel="stylesheet" href="C:/css/my-style.css" type="text/css" />

<div id="TOC">
<ul>
<li><a href="#cargar-paquetes-y-base-de-datos">1. Cargar paquetes y base de datos</a></li>
<li><a href="#algunas-funciones-para-conocerempezar-a-tratar-los-datos">2. Algunas funciones para conocer/empezar a tratar los datos</a></li>
<li><a href="#cambiar-la-naturaleza-de-las-variables-para-empezar-a-trabajar-con-ellas">3. Cambiar la naturaleza de las variables para empezar a trabajar con ellas</a></li>
<li><a href="#renombrar-variables">4. Renombrar variables</a></li>
<li><a href="#tratamiento-valores-perdidos">5. Tratamiento valores perdidos</a></li>
</ul>
</div>

<p>Para cualquier error que detectéis o sugerencia, podéis escribir a <a href="mailto:jcolomer@ugr.es" class="email">jcolomer@ugr.es</a></p>
<div id="cargar-paquetes-y-base-de-datos" class="section level2">
<h2>1. Cargar paquetes y base de datos</h2>
<pre class="r"><code>library(pacman)

p_load(foreign, haven, dplyr, labelled, ggplot2, GGally,
       ggridges, car, carData, viridis, viridisLite, hrbrthemes,
       readr, tidyr, tibble, tidyverse, psych, sjmisc, install = TRUE)

data &lt;- read_sav(&quot;C:/Users/User/Desktop/Tesis/Formación/Seminario R/Base de datos/CIS 2020 - Opinión pública y política fiscal/Database - CISPF.sav&quot;)</code></pre>
</div>
<div id="algunas-funciones-para-conocerempezar-a-tratar-los-datos" class="section level2">
<h2>2. Algunas funciones para conocer/empezar a tratar los datos</h2>
<p>Con str(), estructure, podemos ver la estructura de nuestros datos</p>
<pre class="r"><code>str(data) #Con str(), estructure, podemos ver la estructura de nuestros datos#</code></pre>
<pre class="r"><code>str(data[1:3]) #vemos las 3 primeras variables (columnas)</code></pre>
<pre><code>## tibble [2,926 x 3] (S3: tbl_df/tbl/data.frame)
##  $ ESTU: dbl+lbl [1:2926] 3290, 3290, 3290, 3290, 3290, 3290, 3290, 3290, 3290,...
##    ..@ label        : chr &quot;Nº de estudio&quot;
##    ..@ format.spss  : chr &quot;F4.0&quot;
##    ..@ display_width: int 4
##    ..@ labels       : Named num 3290
##    .. ..- attr(*, &quot;names&quot;)= chr &quot;3290&quot;
##  $ CUES: dbl+lbl [1:2926] 2123,  680, 2522, 1090,  309, 1387,  487,  637,  937,...
##    ..@ label        : chr &quot;Nº de cuestionario&quot;
##    ..@ format.spss  : chr &quot;F5.0&quot;
##    ..@ display_width: int 5
##    ..@ labels       : Named num [1:2926] 1 2 3 4 5 6 7 8 9 10 ...
##    .. ..- attr(*, &quot;names&quot;)= chr [1:2926] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ CCAA: dbl+lbl [1:2926] 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
##    ..@ label        : chr &quot;Comunidad autónoma&quot;
##    ..@ format.spss  : chr &quot;F2.0&quot;
##    ..@ display_width: int 2
##    ..@ labels       : Named num [1:19] 1 2 3 4 5 6 7 8 9 10 ...
##    .. ..- attr(*, &quot;names&quot;)= chr [1:19] &quot;Andalucía&quot; &quot;Aragón&quot; &quot;Asturias (Principado de)&quot; &quot;Balears (Illes)&quot; ...
##  - attr(*, &quot;label&quot;)= chr &quot;filelabel&quot;</code></pre>
<pre class="r"><code>names(data[5:10]) #Vemos los nombres de la variable 5 hasta la 10</code></pre>
<pre><code>## [1] &quot;MUN&quot;      &quot;TAMUNI&quot;   &quot;CAPITAL&quot;  &quot;ZONA&quot;     &quot;ENTREV&quot;   &quot;TIPO_TEL&quot;</code></pre>
<pre class="r"><code>head(data[1:2]) #Vemos el nombre de la variable y las seis primeras puntuaciones (podemos pedir m?s en los argumentos de la funci?n)</code></pre>
<pre><code>## # A tibble: 6 x 2
##          ESTU        CUES
##     &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt;
## 1 3290 [3290] 2123 [2123]
## 2 3290 [3290]  680 [680] 
## 3 3290 [3290] 2522 [2522]
## 4 3290 [3290] 1090 [1090]
## 5 3290 [3290]  309 [309] 
## 6 3290 [3290] 1387 [1387]</code></pre>
<pre class="r"><code>data$identificador &lt;- 1:nrow(data)</code></pre>
</div>
<div id="cambiar-la-naturaleza-de-las-variables-para-empezar-a-trabajar-con-ellas" class="section level2">
<h2>3. Cambiar la naturaleza de las variables para empezar a trabajar con ellas</h2>
<pre class="r"><code>class(data$P15) #Nos devuelve: [1] &quot;haven_labelled&quot; &quot;vctrs_vctr&quot;     &quot;double&quot; </code></pre>
<pre><code>## [1] &quot;haven_labelled&quot; &quot;vctrs_vctr&quot;     &quot;double&quot;</code></pre>
<pre class="r"><code>table(data$P15) #Comprobamos como se distribuyen las respuestas#</code></pre>
<pre><code>## 
##    1    2    8    9 
##  453 2258  196   19</code></pre>
<p>Una forma rápida de pasar las variables de ‘haven labelled’ a numeric (más útil para la mayoría de nuestros análisis):</p>
<pre class="r"><code>val_labels(data) &lt;- NULL</code></pre>
<p>Volvemos a comprobar su naturaleza:</p>
<pre class="r"><code>class(data$P15) #Nos devuelve: [1] &quot;haven_labelled&quot; &quot;vctrs_vctr&quot;     &quot;double&quot; </code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Y que no hayan cambiado los valores:</p>
<pre class="r"><code>table(data$P15) #Comprobamos cómo se distribuyen las respuestas#</code></pre>
<pre><code>## 
##    1    2    8    9 
##  453 2258  196   19</code></pre>
<p>Una forma más tediosa pero en la vamos viendo qué hacemos paso a paso:</p>
<pre class="r"><code>data$SEXO &lt;- to_factor(data$SEXO)
data$EDAD &lt;- as.numeric(data$EDAD)
data$ESCAFELI &lt;- as.numeric(data$ESCAFELI) 
data$ESCACONFIANZA &lt;- as.numeric(data$ESCACONFIANZA) 
data$P4_1 &lt;- as.numeric(data$P4_1) 
data$P4_2 &lt;- as.numeric(data$P4_2) 
data$P4_3 &lt;- as.numeric(data$P4_3)
data$P4_4 &lt;- as.numeric(data$P4_4) 
data$P4_5 &lt;- as.numeric(data$P4_5) 
data$P4_6 &lt;- as.numeric(data$P4_6)
data$P7 &lt;- to_factor(data$P7)
data$ESCAIMPUESTOS &lt;- as.numeric(data$ESCAIMPUESTOS)
data$INTERVENESTADO &lt;- to_factor(data$INTERVENESTADO)
data$DESIGUALDAD &lt;- as.numeric(data$DESIGUALDAD)
data$ESCAPOSICION &lt;- as.numeric(data$ESCAPOSICION)
data$ESCIDEOL &lt;- as.numeric(data$ESCIDEOL)
data$CLASESUB &lt;- to_factor(data$CLASESUB)
data$INGREHOG &lt;- as.numeric(data$INGREHOG)
data$NIVELESTENTREV &lt;- as.numeric(data$NIVELESTENTREV)</code></pre>
</div>
<div id="renombrar-variables" class="section level2">
<h2>4. Renombrar variables</h2>
<p>Con la función ‘rename’ del paquete ‘dplyr’, primero el nombre nuevo y después el nombre antiguo.</p>
<pre class="r"><code>data &lt;- data %&gt;% 
  dplyr::rename(item1 = P4_1, item2 = P4_2, item3 = P4_3, item4 = P4_4, 
                item5 = P4_5, item6 = P4_6)</code></pre>
</div>
<div id="tratamiento-valores-perdidos" class="section level2">
<h2>5. Tratamiento valores perdidos</h2>
<p>La forma más fácil y recomentable, utilizando el paquete ‘naniar’:</p>
<pre class="r"><code>library(naniar)</code></pre>
<pre><code>## 
## Attaching package: &#39;naniar&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:sjmisc&#39;:
## 
##     all_na</code></pre>
<pre class="r"><code>data &lt;- data %&gt;%
  replace_with_na(replace = list(ESCAFELI = c(98,99),
                                 ESCACONFIANZA = c(98,99),
                                 item1 = c(98,99),
                                 item2 = c(98,99),
                                 item3 = c(98,99),
                                 item4 = c(98,99),
                                 item5 = c(98,99),
                                 item6 = c(98,99),
                                 ESCAIMPUESTOS = c(98,99),
                                 ESCAPOSICION = c(98,99),
                                 CLASESUB = c(8, 9), 
                                 ESCIDEOL = c(97, 98, 99), 
                                 DESIGUALDAD = c(8, 9),
                                 INTERVENESTADO = c(8, 9),
                                 NIVELESTENTREV = c(16, 98, 99),
                                 INGREHOG = c(98, 99)))</code></pre>
</div>
