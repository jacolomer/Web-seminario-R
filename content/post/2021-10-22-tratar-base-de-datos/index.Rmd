---
title: Tratar base de datos (sin terminar)
author: Joaquín Alcañiz Colomer
date: '2021-10-22'
slug: tratar-base-de-datos
categories:
  - Estadística
tags: []
output:
  blogdown::html_page:
    toc: true
    css: "/css/my-style.css"
leng: es-ES 
---

```{r, include=FALSE}
library(rmarkdown)
library(markdown)
library(extrafont)
loadfonts(device = "win")
```

Para cualquier error que detectéis o sugerencia, podéis escribir a jcolomer@ugr.es 

## 1. Cargar paquetes y base de datos


```{r}

library(pacman)

p_load(foreign, haven, dplyr, labelled, ggplot2, GGally,
       ggridges, car, carData, viridis, viridisLite, hrbrthemes,
       readr, tidyr, tibble, tidyverse, psych, sjmisc, install = TRUE)

data <- read_sav("C:/Users/User/Desktop/Tesis/Formación/Seminario R/Base de datos/CIS 2020 - Opinión pública y política fiscal/Database - CISPF.sav")
```


## 2. Algunas funciones para conocer/empezar a tratar los datos

Con str(), estructure, podemos ver la estructura de nuestros datos

```{r, results='hide'}
str(data) #Con str(), estructure, podemos ver la estructura de nuestros datos#
```

```{r}
str(data[1:3]) #vemos las 3 primeras variables (columnas)
```

```{r}
names(data[5:10]) #Vemos los nombres de la variable 5 hasta la 10
```


```{r}
head(data[1:2]) #Vemos el nombre de la variable y las seis primeras puntuaciones (podemos pedir m?s en los argumentos de la funci?n)
```


```{r}
data$identificador <- 1:nrow(data)

```

## 3. Cambiar la naturaleza de las variables para empezar a trabajar con ellas

```{r}
class(data$P15) #Nos devuelve: [1] "haven_labelled" "vctrs_vctr"     "double" 
```



```{r}
table(data$P15) #Comprobamos como se distribuyen las respuestas#
```


Una forma rápida de pasar las variables de 'haven labelled' a numeric (más útil para la mayoría de nuestros análisis):  

```{r}
val_labels(data) <- NULL
```

Volvemos a comprobar su naturaleza: 


```{r}
class(data$P15) #Nos devuelve: [1] "haven_labelled" "vctrs_vctr"     "double" 
```

Y que no hayan cambiado los valores: 


```{r}
table(data$P15) #Comprobamos cómo se distribuyen las respuestas#
```

Una forma más tediosa pero en la vamos viendo qué hacemos paso a paso: 

```{r}
data$SEXO <- to_factor(data$SEXO)
data$EDAD <- as.numeric(data$EDAD)
data$ESCAFELI <- as.numeric(data$ESCAFELI) 
data$ESCACONFIANZA <- as.numeric(data$ESCACONFIANZA) 
data$P4_1 <- as.numeric(data$P4_1) 
data$P4_2 <- as.numeric(data$P4_2) 
data$P4_3 <- as.numeric(data$P4_3)
data$P4_4 <- as.numeric(data$P4_4) 
data$P4_5 <- as.numeric(data$P4_5) 
data$P4_6 <- as.numeric(data$P4_6)
data$P7 <- to_factor(data$P7)
data$ESCAIMPUESTOS <- as.numeric(data$ESCAIMPUESTOS)
data$INTERVENESTADO <- to_factor(data$INTERVENESTADO)
data$DESIGUALDAD <- as.numeric(data$DESIGUALDAD)
data$ESCAPOSICION <- as.numeric(data$ESCAPOSICION)
data$ESCIDEOL <- as.numeric(data$ESCIDEOL)
data$CLASESUB <- to_factor(data$CLASESUB)
data$INGREHOG <- as.numeric(data$INGREHOG)
data$NIVELESTENTREV <- as.numeric(data$NIVELESTENTREV)
```

## 4. Renombrar variables

Con la función 'rename' del paquete 'dplyr', primero el nombre nuevo y después el nombre antiguo. 

```{r}
data <- data %>% 
  dplyr::rename(item1 = P4_1, item2 = P4_2, item3 = P4_3, item4 = P4_4, 
                item5 = P4_5, item6 = P4_6)
```


## 5. Tratamiento valores perdidos

La forma más fácil y recomentable, utilizando el paquete 'naniar': 

```{r}
library(naniar)

data <- data %>%
  replace_with_na(replace = list(ESCAFELI = c(98,99),
                                 ESCACONFIANZA = c(98,99),
                                 item1 = c(98,99),
                                 item2 = c(98,99),
                                 item3 = c(98,99),
                                 item4 = c(98,99),
                                 item5 = c(98,99),
                                 item6 = c(98,99),
                                 ESCAIMPUESTOS = c(98,99),
                                 ESCAPOSICION = c(98,99),
                                 CLASESUB = c(8, 9), 
                                 ESCIDEOL = c(97, 98, 99), 
                                 DESIGUALDAD = c(8, 9),
                                 INTERVENESTADO = c(8, 9),
                                 NIVELESTENTREV = c(16, 98, 99),
                                 INGREHOG = c(98, 99)))

```








